<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AgroCalc ‚Äì Integrado com Gr√°fico</title>
<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<header>
  <img src="logo.png" alt="Logo AgroCalc">
  <div class="header-info">
    <h1>AgroCalc</h1>
    <p>CEPI</p>
  </div>
</header>

<main>
<div class="card">
<h2>AgroCalc Integrado ‚Äì Teor + Quantidade</h2>

<label for="mg">Teor de Magn√©sio (Mg %)</label>
<input type="number" id="mg" placeholder="Ex: 3.5">

<label for="ca">Teor de C√°lcio (Ca %)</label>
<input type="number" id="ca" placeholder="Ex: 18">

<label for="tipo">Tipo de Calc√°rio:</label>
<select id="tipo">
<option value="calcitico">Calc√≠tico</option>
<option value="dolomitico">Dolom√≠tico</option>
</select>

<label for="area">√Årea:</label>
<input type="number" id="area" placeholder="Ex: 10">
<select id="unit-area">
<option value="ha">hectares (ha)</option>
<option value="m2">m¬≤</option>
</select>

<label for="recomendado">Quantidade recomendada por √°rea:</label>
<input type="number" id="recomendado" placeholder="Ex: 2">
<select id="unit-qtd">
<option value="t">t</option>
<option value="kg">kg</option>
</select>

<button onclick="calcularIntegrado()">Calcular</button>

<div id="resultado"></div>
<canvas id="grafico" style="margin-top:25px;"></canvas>
</div>
</main>

<footer>
Desenvolvido por Brenno Board
<div class="agro-info">3¬∫ Agro</div>
</footer>

<script>
let chartInstance=null;

function calcularIntegrado(){
  let mg=parseFloat(document.getElementById('mg').value);
  let ca=parseFloat(document.getElementById('ca').value);
  let tipo=document.getElementById('tipo').value;
  let area=parseFloat(document.getElementById('area').value);
  let unitArea=document.getElementById('unit-area').value;
  let qtd=parseFloat(document.getElementById('recomendado').value);
  let unitQtd=document.getElementById('unit-qtd').value;
  const resDiv=document.getElementById('resultado');

  resDiv.innerHTML='<div class="loading"><span></span><span></span><span></span> Processando...</div>';

  setTimeout(()=>{
    if(isNaN(mg) || isNaN(ca) || isNaN(area) || isNaN(qtd)){
      resDiv.innerHTML='<div class="resultado-card">‚ö†Ô∏è Preencha todos os campos corretamente.</div>';
      return;
    }

    if(unitArea==='m2') area=area/10000;
    if(unitQtd==='kg') qtd=qtd/1000;

    let tipoCalcario='';
    let obs='';
    if(mg<5 && ca<20){tipoCalcario='Dolom√≠tico üå±'; obs='Aplicar dolom√≠tico para equilibrar Ca e Mg.';}
    else if(mg>=5 && ca<20){tipoCalcario='Calc√≠tico üå±'; obs='Aplicar calc√≠tico para aumentar Ca.';}
    else{tipoCalcario='N√≠veis adequados üåæ'; obs='Solo equilibrado, ajuste opcional.';}

    const vBase=(ca+mg);
    const total=area*qtd;

    resDiv.innerHTML=`<div class="resultado-card">
    Tipo recomendado: ${tipoCalcario}<br>
    Satura√ß√£o de bases: ${vBase.toFixed(1)}%<br>
    C√°lcio atual: ${ca.toFixed(1)}%, Magn√©sio atual: ${mg.toFixed(1)}%<br>
    Quantidade total: ${total.toFixed(2)} t<br>
    Observa√ß√£o: ${obs}
    </div>`;

    const ctx=document.getElementById('grafico').getContext('2d');
    if(chartInstance) chartInstance.destroy();

    chartInstance=new Chart(ctx,{
      type:'bar',
      data:{
        labels:['C√°lcio (Ca %)','Magn√©sio (Mg %)','Satura√ß√£o de bases (V %)'],
        datasets:[{
          label:'Valores do Solo',
          data:[ca,mg,vBase.toFixed(1)],
          backgroundColor:['#4b7a4b','#6bb36b','#a1d99b']
        }]
      },
      options:{
        responsive:true,
        plugins:{
          legend:{display:false},
          title:{display:true,text:'Perfil do Solo üå±',font:{size:18}}
        },
        scales:{
          y:{beginAtZero:true,max:100}
        }
      }
    });

  },2500);
}
</script>
</body>
</html>
